<!DOCTYPE html>
<html>
  <head>
    <title>LiveFire Food Calculator</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: #000000; /* dark text color */
        background: linear-gradient(45deg, #9eaebd, #d4d5d6, #9eaebd, #d4d5d6);
        background-size: 400% 400%;
        padding: 40px;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-image: url("img/Bryan.Rice_a_bunch_of_space_aliens_standing_around_a_grill_watc_94fa5349-5d93-4af0-a652-99468197a5d6.png");
        background-repeat: no-repeat;
        background-size: cover;
      }

      @keyframes gradient {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .glass {
        background: rgba(255, 255, 255, 0.7);
        border-radius: 10px;
        padding: 30px;
        width: 320px;
        height: auto;
        backdrop-filter: blur(2px);
        box-shadow: 10px 10px 10px rgba(128, 128, 128, 0.2);
      }

      h1 {
        text-align: center;
        font-size: 1.5em;
      }

      p {
        font-size: 1.2em;
        line-height: 1.6;
        margin-bottom: 20px;
      }

      select,
      input,
      button {
        font-size: 1em;
        padding: 10px;
        width: 100%;
        border: none;
        border-radius: 5px;
        box-sizing: border-box;
        margin-bottom: 10px;
        background: rgba(255, 255, 255, 0.5);
        color: #000000; /* dark text color */
      }

      input {
        border: 1px solid #000000; /* dark text color */
      }

      button {
        cursor: pointer;
        transition: background-color 0.3s ease;
        background: linear-gradient(45deg, #9eaebd, #d4d5d6, #9eaebd, #d4d5d6);
        background-size: 400% 400%;
        color: #000000; /* dark text color */
      }

      button:hover {
        background: linear-gradient(45deg, #d4d5d6, #9eaebd, #d4d5d6, #9eaebd);
      }

      span {
        color: #000000; /* dark text color */
        font-weight: bold;
      }

      #loadingIndicator {
        text-align: center;
        font-weight: bold;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="glass">
      <h1>LiveFire Food Calculator</h1>
      <p>
        Meat Type:
        <select id="meatType">
          <option value="chicken">Chicken</option>
          <option value="beef">Beef</option>
          <option value="pork">Pork</option>
        </select>
      </p>
      <p>
        Cost per Pound ($):
        <input type="number" id="costPerPound" value="2.80" step="0.01" />
      </p>
      <p>
        Yield Percentage (%):
        <input type="number" id="yieldPercent" value="50" step="0.01" />
      </p>
      <p>
        Number of People:
        <input
          type="number"
          id="numPeople"
          value="100"
          min="1"
          step="1"
        />
      </p>
      <button onclick="calculate()">Calculate</button>
      <button onclick="saveManualPrice()">Save Price</button>
      <p>Finished Weight: <span id="finishedWeight"></span></p>
      <p>Raw Weight: <span id="rawWeight"></span></p>
      <p>Total Cost: <span id="totalCost"></span></p>
      <div id="loadingIndicator" style="display: none;">Updating prices...</div>
    </div>
    <script>
      const defaultData = {
        chicken: { costPerPound: 2.80, yieldPercent: 50 },
        beef: { costPerPound: 5.00, yieldPercent: 60 },
        pork: { costPerPound: 3.50, yieldPercent: 55 },
      };

      function initializeData() {
        if (!localStorage.getItem('meatData')) {
          localStorage.setItem('meatData', JSON.stringify(defaultData));
        }
      }

      initializeData();

      function updateYieldAndCost() {
        const meatType = document.getElementById('meatType').value;
        const meatData = JSON.parse(localStorage.getItem('meatData'));

        if (meatData && meatData[meatType]) {
          document.getElementById('costPerPound').value = meatData[meatType].costPerPound;
          document.getElementById('yieldPercent').value = meatData[meatType].yieldPercent;
        }
      }

      async function fetchAndUpdatePrices() {
        document.getElementById('loadingIndicator').style.display = 'block';
        const meatTypes = ['chicken', 'beef', 'pork'];
        const meatData = JSON.parse(localStorage.getItem('meatData')) || defaultData;

        for (const meat of meatTypes) {
          try {
            // Placeholder for API call
            // Replace simulateAPICall with actual API call to your backend
            const fetchedPrice = await simulateAPICall(meat);
            if (fetchedPrice) {
              meatData[meat].costPerPound = fetchedPrice;
            }
          } catch (error) {
            console.error(`Failed to update ${meat} price:`, error);
          }
        }

        localStorage.setItem('meatData', JSON.stringify(meatData));
        updateYieldAndCost();
        document.getElementById('loadingIndicator').style.display = 'none';
      }

      function simulateAPICall(meatType) {
        return new Promise((resolve) => {
          setTimeout(() => {
            // Simulated fetched prices
            const simulatedPrices = {
              chicken: 3.00,
              beef: 5.50,
              pork: 4.00,
            };
            resolve(simulatedPrices[meatType]);
          }, 1000); // Simulate network delay
        });
      }

      function saveManualPrice() {
        const meatType = document.getElementById('meatType').value;
        const costPerPound = parseFloat(document.getElementById('costPerPound').value);
        const yieldPercent = parseFloat(document.getElementById('yieldPercent').value);
        const meatData = JSON.parse(localStorage.getItem('meatData')) || defaultData;

        meatData[meatType] = { costPerPound, yieldPercent };
        localStorage.setItem('meatData', JSON.stringify(meatData));

        alert(`${meatType.charAt(0).toUpperCase() + meatType.slice(1)} data updated.`);
      }

      function calculate() {
        const numPeople = parseInt(document.getElementById('numPeople').value);
        const costPerPound = parseFloat(document.getElementById('costPerPound').value);
        const yieldPercent = parseFloat(document.getElementById('yieldPercent').value);

        const finishedWeight = numPeople / 2.6;
        const rawWeight = finishedWeight / (yieldPercent / 100);
        const totalCost = rawWeight * costPerPound;

        document.getElementById('finishedWeight').innerHTML = finishedWeight.toFixed(2) + ' lbs';
        document.getElementById('rawWeight').innerHTML = rawWeight.toFixed(2) + ' lbs';
        document.getElementById('totalCost').innerHTML = '$' + totalCost.toFixed(2);
      }

      document.getElementById('meatType').addEventListener('change', () => {
        updateYieldAndCost();
        calculate();
      });

      // Initialize the app
      updateYieldAndCost();
      calculate();
      fetchAndUpdatePrices();
    </script>
  </body>
</html>